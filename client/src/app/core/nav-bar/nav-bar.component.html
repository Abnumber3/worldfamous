<nav class="navbar navbar-expand-lg bg-dark p-3 fixed-top shadow-sm border-bottom border-secondary" data-bs-theme="dark">
  <div class="container-fluid">

    <!-- Brand -->
    <div class="d-flex align-items-center">
      <img
        src="/WF-Images/globe.png"
        alt="WorldFamous logo"
        width="42" height="42"
        class="me-2"
        routerLink="/"
      />
      <a class="navbar-brand text-white fs-5" routerLink="/">WorldFamous LLC</a>
    </div>

    <!-- Toggler -->
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarCollapse"
      aria-controls="navbarCollapse"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Collapsible -->
    <div id="navbarCollapse" class="collapse navbar-collapse justify-content-between">

      <!-- Center Nav -->
      <ul class="navbar-nav mx-auto text-uppercase fw-semibold gap-lg-4 gap-2">
        <li class="nav-item">
          <a
            class="nav-link text-white"
            routerLink="/"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: true }"
          >Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" routerLink="/shop" routerLinkActive="active">Shop</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" routerLink="/test-error" routerLinkActive="active">Errors</a>
        </li>
      </ul>

      <!-- Right Side -->
      <div class="d-flex align-items-center gap-2">

        <!-- Cart -->
        <a routerLink="/basket" class="position-relative me-3" aria-label="View basket">
          <i class="fa fa-shopping-cart fa-lg text-white"></i>
          <span
            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
            aria-live="polite"
            aria-atomic="true"
            style="font-size:.7rem"
          >
            <ng-container *ngIf="(basket$ | async) as basket">{{ basket.items.length }}</ng-container>
          </span>
        </a>

        <!-- Auth: Logged out -->
        <ng-container *ngIf="(currentUser$ | async) === null">
          <a
            routerLink="/account/login"
            class="btn btn-outline-light btn-sm px-3"
            routerLinkActive="active"
          >Login</a>
          <a
            routerLink="/account/register"
            class="btn btn-light btn-sm px-3"
            routerLinkActive="active"
          >Register</a>
        </ng-container>

        <!-- Auth: Logged in -->
        <ng-container *ngIf="currentUser$ | async as user">
          <div class="dropdown ms-3 me-5">
            <a
              id="userDropdown"
              class="dropdown-toggle text-white text-decoration-none"
              href="#"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              Welcome {{ user.displayName }}!
            </a>

            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
              <li>
                <a class="dropdown-item d-flex align-items-center py-2" routerLink="/basket">
                  <i class="fa fa-shopping-cart me-2"></i> View Basket
                </a>
              </li>
              <li>
                <a class="dropdown-item d-flex align-items-center py-2" routerLink="/orders">
                  <i class="fa fa-history me-2"></i> View Orders
                </a>
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <a class="dropdown-item d-flex align-items-center py-2 "style="cursor: pointer;" (click)="logout()">
                  <i class="fa fa-sign-out me-2" ></i> Logout
                </a>
              </li>
            </ul>
          </div>
        </ng-container>

      </div>
    </div>
  </div>
</nav>
